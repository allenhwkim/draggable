<!DOCTYPE html>
<html>
<head>
<script>
var Draggable = function(element, options) {
  this.el = element;
  this.tmpArea = null;  //when drag starts, create a temporary dragging area so that mouse can move around
  this.boundary = document.body;
  this.startedWith = null;
  this.callbacks = {};
  this.init = function(element, options) {
    if (options) {
      if (options.boundary)  this.boundary = options.boundary;
      if (options.callbacks) this.callbacks = options.callbacks;
    }
    element.addEventListener("mousedown", this.start, false);
  };
  var that = this;
  this.start = function(event) {
    if (!that.tmpArea) {
      var rect = that.boundary.getBoundingClientRect();
      var tmpArea = document.createElement('div');
      tmpArea.style.cssText = "position:absolute; background-color:blue; opacity:0.4; "+
        "width:"+rect.width+"px; height:"+rect.height+"px; top:"+rect.top+"px left:"+rect.left+"px";
      if (that.boundary.style.position == "relative") {
        tmpArea.style.top = "0px";
        tmpArea.style.left = "0px";
      }
      that.boundary.appendChild(tmpArea);
      tmpArea.addEventListener('mousemove',that.drag, false);
      tmpArea.addEventListener('mouseup',that.end, false);
      that.tmpArea = tmpArea;
      var rect = that.el.getBoundingClientRect();
      that.el.style.position ='absolute';
      that.el.style.width = rect.width+'px';
      that.el.style.height = rect.height+'px';
      that.startedWith = { event : event, rect : rect };
      if (that.callbacks.start) {
        that.callbacks.start.call(this, event, that.el);
      }
    }
  };
  this.drag =  function(event) {
    if (event.which == 1) {
      var boundaryRect = that.boundary.getBoundingClientRect();
      var elRect = that.el.getBoundingClientRect();
      var newLeft = that.startedWith.rect.left + (event.clientX - that.startedWith.event.clientX);
      var newRight = that.startedWith.rect.right + (event.clientX - that.startedWith.event.clientX);
      var newTop  = that.startedWith.rect.top  + (event.clientY - that.startedWith.event.clientY);
      var newBottom  = that.startedWith.rect.bottom  + (event.clientY - that.startedWith.event.clientY);
      if (newLeft > boundaryRect.left && newRight < boundaryRect.right) {
        if (that.boundary.style.position=="relative") 
          that.el.style.left  = (newLeft - boundaryRect.left)+'px';
        else
          that.el.style.left  = newLeft+'px';
      }
      if (newTop > boundaryRect.top && newBottom < boundaryRect.bottom) {
        if (that.boundary.style.position=="relative") 
          that.el.style.top  = (newTop - boundaryRect.top)+'px';
        else
          that.el.style.top  = newTop+'px';
      }
      if (that.callbacks.drag) {
        that.callbacks.drag.call(this, event, that.el);
      }
    }
  };
  this.end = function(event) {
    if (that.tmpArea) {
      that.boundary.removeChild( that.tmpArea );
      that.tmpArea = null;
    }
    if (that.callbacks.end) {
      that.callbacks.end.call(this, event, that.el);
    }
  };
  this.init(element,options);
  return element;
}

window.onload = function() {
  var el = document.querySelector(".draggable");
  new Draggable(el, {
    boundary: document.querySelector(".outside"),
    callbacks: {
      drag: function(event, el) { //event : mousemove event, el: dragging element
        var yPos = parseInt(el.style.top);
        var topHeight = 300 - ((300-yPos));
        var bottomHeight = (300 - yPos) - 10;
        document.querySelector(".top").style.height = topHeight+'px';
        document.querySelector(".bottom").style.height = bottomHeight+'px';
      }
    }
  });
}
</script>
</head>
<body>
  <div class="outside" style="height:300px;border:1px outset;position:relative;">
    <div class="top" style="background-color:red; height:145px;margin-bottom:10px"></div>
    <div class="draggable" style="background-color:green; height:10px; position:absolute; top:145px; width:100%;">&nbsp;</div>
    <div class="bottom" style="background-color:blue; height: 145px;">&nbsp;</div>
  </div>
</body>
</html>
